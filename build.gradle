buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath 'com.palantir:jacoco-coverage:0.4.0'
    }
}

plugins {
    id 'ru.vyarus.quality' version '3.3.0'
}

allprojects {
    apply plugin: 'ru.vyarus.quality'
    apply plugin: 'java'
    apply plugin: 'com.palantir.jacoco-coverage'
    apply plugin: 'com.palantir.jacoco-full-report'

    repositories {
        mavenCentral()
        jcenter()
        maven { url "https://jitpack.io" }
    }

    dependencies {
        implementation group: 'org.testng', name: 'testng', version: '6.14.3'
        implementation group: 'org.json', name: 'json', version: '20180130'
        implementation group: 'io.rest-assured', name: 'rest-assured', version: '3.3.0'
    }

    task sourcesJar(type: Jar, dependsOn: classes) {
        classifier = 'sources'
        from sourceSets.main.allSource
    }

    task javadocJar(type: Jar, dependsOn: javadoc) {
        classifier = 'javadoc'
        from javadoc.destinationDir
    }

    artifacts {
        archives sourcesJar
        archives javadocJar
    }
}

subprojects {
    test {
        useTestNG() {
            testLogging {
                events "passed", "skipped", "failed"
                exceptionFormat = 'full'
                showStandardStreams = false
            }

            options {
                setParallel('classes')
                setThreadCount(10)
            }
        }
    }

    quality {
        checkstyle = true
        pmd = true
        findbugs = true
        codenarc = true
        spotbugs = true
    }
}

tasks.jacocoFullReport.dependsOn subprojects.collect { it.tasks.test }

wrapper.gradleVersion = '5.2.1'